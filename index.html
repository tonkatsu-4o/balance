<!DOCTYPE html>
<html lang="ja" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEO-WIKI | TeX Archive</title>
    
    <!-- Tailwind CSS (Design) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            black: '#0a0a0c',
                            dark: '#13141f',
                            panel: '#1c1e2e',
                            primary: '#00f0ff', // Cyan
                            secondary: '#7000ff', // Purple
                            text: '#e0e6ed',
                            dim: '#94a3b8'
                        }
                    },
                    fontFamily: {
                        mono: ['"Fira Code"', 'Consolas', 'Monaco', 'monospace'],
                        sans: ['"Inter"', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <!-- MathJax (TeX Rendering) -->
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            tags: 'ams' // Equation numbering
        },
        options: {
            renderActions: {
                addMenu: [0, '', ''] // Disable right-click menu for cleaner look
            }
        }
    };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script" async></script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0a0c; 
        }
        ::-webkit-scrollbar-thumb {
            background: #1c1e2e; 
            border: 1px solid #00f0ff;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #00f0ff;
        }

        /* Sci-Fi Glow Effects */
        .neon-text {
            text-shadow: 0 0 5px rgba(0, 240, 255, 0.5);
        }
        .neon-border {
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.1);
        }

        /* Math Scroll Wrapper */
        .math-scroll-wrapper {
            overflow-x: auto;
            max-width: 100%;
            padding: 0.5rem 0;
            margin-bottom: 1rem;
            /* Hide scrollbar for cleaner look until hovered, or keep visible implies functionality */
            -webkit-overflow-scrolling: touch;
        }
        
        /* Loading Animation */
        .loader {
            border: 2px solid #1c1e2e;
            border-top: 2px solid #00f0ff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Article Content Styling */
        #article-content h1 { @apply text-3xl font-bold text-cyber-primary mb-6 border-b border-cyber-secondary/30 pb-2 mt-8; }
        #article-content h2 { @apply text-2xl font-semibold text-white mb-4 mt-8 flex items-center before:content-['#'] before:text-cyber-secondary before:mr-2; }
        #article-content h3 { @apply text-xl font-medium text-cyber-dim mb-3 mt-6; }
        #article-content p { @apply mb-4 leading-relaxed text-cyber-text; }
        #article-content ul { @apply list-disc list-inside mb-4 ml-4 text-cyber-text; }
        #article-content ol { @apply list-decimal list-inside mb-4 ml-4 text-cyber-text; }
        #article-content blockquote { @apply border-l-4 border-cyber-primary pl-4 py-1 my-4 bg-cyber-panel/50 italic; }
        
        /* Mobile adjustment for math */
        mjx-container[display="true"] {
            margin: 1em 0 !important;
        }
    </style>
</head>
<body class="bg-cyber-black text-cyber-text font-sans antialiased h-screen flex flex-col overflow-hidden selection:bg-cyber-primary selection:text-cyber-black">

    <!-- Header -->
    <header class="h-16 border-b border-cyber-panel bg-cyber-dark/80 backdrop-blur-md flex items-center justify-between px-4 z-50 shrink-0">
        <div class="flex items-center gap-3">
            <button id="menu-toggle" class="lg:hidden p-2 text-cyber-primary hover:bg-cyber-panel rounded transition">
                <i data-lucide="menu"></i>
            </button>
            <div class="flex items-center gap-2 cursor-pointer" onclick="loadArticle('home')">
                <i data-lucide="cpu" class="text-cyber-primary"></i>
                <h1 class="font-mono text-lg font-bold tracking-wider text-white neon-text">NEO-WIKI <span class="text-xs text-cyber-secondary align-top">v1.0</span></h1>
            </div>
        </div>
        <div class="flex items-center gap-4 text-xs font-mono text-cyber-dim">
            <span class="hidden md:inline-block">SYS.STATUS: <span class="text-green-400">ONLINE</span></span>
            <a href="https://github.com" target="_blank" class="hover:text-white transition"><i data-lucide="github" class="w-5 h-5"></i></a>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative">
        <!-- Sidebar (Navigation) -->
        <aside id="sidebar" class="absolute lg:relative w-64 h-full bg-cyber-dark border-r border-cyber-panel transform -translate-x-full lg:translate-x-0 transition-transform duration-300 z-40 overflow-y-auto">
            <div class="p-4">
                <div class="text-xs font-mono text-cyber-primary mb-4 uppercase tracking-widest border-b border-cyber-panel pb-2">Directory</div>
                
                <!-- Navigation Tree -->
                <nav id="nav-tree" class="space-y-1 font-mono text-sm">
                    <!-- Dynamic Content populated by JS -->
                </nav>
            </div>
        </aside>

        <!-- Overlay for mobile sidebar -->
        <div id="overlay" class="fixed inset-0 bg-black/50 z-30 hidden lg:hidden backdrop-blur-sm"></div>

        <!-- Main Content -->
        <main class="flex-1 relative overflow-y-auto bg-cyber-black" id="main-scroll">
            <!-- Decorative Grid Background -->
            <div class="absolute inset-0 z-0 pointer-events-none opacity-20" 
                style="background-image: linear-gradient(#1c1e2e 1px, transparent 1px), linear-gradient(90deg, #1c1e2e 1px, transparent 1px); background-size: 40px 40px;">
            </div>

            <div class="relative z-10 max-w-4xl mx-auto p-6 md:p-10 min-h-full">
                <!-- Breadcrumbs -->
                <div id="breadcrumbs" class="text-xs font-mono text-cyber-secondary mb-6 flex items-center gap-2">
                    <span>ROOT</span> <i data-lucide="chevron-right" class="w-3 h-3"></i> <span class="text-cyber-primary">HOME</span>
                </div>

                <!-- Content Area -->
                <article id="article-content" class="animate-fade-in pb-20">
                    <!-- Content injected here -->
                </article>

                <!-- Loading Indicator -->
                <div id="loader" class="hidden absolute inset-0 flex items-center justify-center bg-cyber-black z-50">
                    <div class="loader"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        
        // GitHub Pagesで運用する場合、このフラグをfalseにしてください。
        // trueの場合: 以下の mockDatabase から記事を読み込みます。
        // falseの場合: サーバー上の .tex ファイルを fetch() で取得しに行きます。
        const IS_PREVIEW_MODE = true; 
        
        const REPO_BASE_URL = './docs/'; // 実際の運用時の .tex ファイル置き場

        // --- 2. DATA STRUCTURE (File System) ---
        
        // 階層構造定義 (サイドバー用)
        const directoryStructure = [
            {
                title: "Home",
                id: "home",
                icon: "home"
            },
            {
                title: "Physics",
                id: "physics",
                icon: "atom",
                children: [
                    { title: "Quantum Mechanics", id: "quantum_basics", file: "physics/quantum.tex" },
                    { title: "Relativity", id: "relativity", file: "physics/relativity.tex" }
                ]
            },
            {
                title: "Mathematics",
                id: "math",
                icon: "sigma",
                children: [
                    { title: "Linear Algebra", id: "linear_algebra", file: "math/linear_algebra.tex" },
                    { title: "Calculus", id: "calculus", file: "math/calculus.tex" }
                ]
            },
            {
                title: "System Specs",
                id: "specs",
                icon: "terminal",
                file: "system/specs.tex"
            }
        ];

        // 擬似ファイルデータベース (プレビュー用)
        // 実際には .tex ファイルの中身がここにあると仮定してください。
        const mockDatabase = {
            "home": String.raw`
# Welcome to NEO-WIKI

これは **LaTeX** ベースのパーソナルWikiシステムです。
左側のナビゲーションから記事を選択してください。

## 特徴
- **外部ファイル参照**: 記事は独立した \`.tex\` ファイルとして管理可能。
- **数式対応**: MathJaxによる高品質なレンダリング。
- **モバイル最適化**: 長い数式はスクロール可能。

## デモ数式
$$ \int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi} $$
            `,
            "physics/quantum.tex": String.raw`
# Quantum Mechanics Basics

シュレーディンガー方程式（Schrödinger equation）は、量子力学における純粋状態の時間発展を記述する基礎方程式である。

## 時間依存シュレーディンガー方程式

$$ i\hbar \frac{\partial}{\partial t} \Psi(\mathbf{r},t) = \hat{H} \Psi(\mathbf{r},t) $$

ここで、
- $i$ : 虚数単位
- $\hbar$ : プランク定数
- $\hat{H}$ : ハミルトニアン演算子
- $\Psi$ : 波動関数

## 長い数式のスクロールテスト
スマホで見た場合、以下の長い数式は横スクロール可能です。

$$
\begin{aligned}
    f(x) &= a_0 + \sum_{n=1}^{\infty} \left( a_n \cos \frac{n\pi x}{L} + b_n \sin \frac{n\pi x}{L} \right) \\
    &= \frac{1}{2L} \int_{-L}^{L} f(t) dt + \sum_{n=1}^{\infty} \left[ \left( \frac{1}{L} \int_{-L}^{L} f(t) \cos \frac{n\pi t}{L} dt \right) \cos \frac{n\pi x}{L} + \left( \frac{1}{L} \int_{-L}^{L} f(t) \sin \frac{n\pi t}{L} dt \right) \sin \frac{n\pi x}{L} \right]
\end{aligned}
$$
            `,
            "physics/relativity.tex": String.raw`
# Theory of Relativity

アインシュタインの場の方程式：

$$ R_{\mu\nu} - \frac{1}{2}R g_{\mu\nu} + \Lambda g_{\mu\nu} = \frac{8\pi G}{c^4} T_{\mu\nu} $$

時空の幾何学構造（左辺）と、物質・エネルギーの分布（右辺）を結びつける。
            `,
            "math/linear_algebra.tex": String.raw`
# Linear Algebra

固有値問題は次のように記述される。

$$ A\mathbf{v} = \lambda\mathbf{v} $$

行列 $A$ が対角化可能であるための条件などを記述する。
            `,
            "math/calculus.tex": String.raw`
# Calculus

微分積分の基本定理。

$$ \frac{d}{dx} \int_{a}^{x} f(t) dt = f(x) $$
            `,
            "system/specs.tex": String.raw`
# System Specifications

## Architecture
- **Frontend**: HTML5, Tailwind CSS
- **Logic**: Vanilla JavaScript
- **Rendering**: MathJax v3

## How to Deploy on GitHub
1. Create a repository.
2. Enable GitHub Pages (Source: /root or /docs).
3. Upload \`.tex\` files to the folder structure.
4. Set \`IS_PREVIEW_MODE = false\` in JS.
            `
        };


        // --- 3. SYSTEM LOGIC ---

        const dom = {
            navTree: document.getElementById('nav-tree'),
            article: document.getElementById('article-content'),
            sidebar: document.getElementById('sidebar'),
            overlay: document.getElementById('overlay'),
            breadcrumbs: document.getElementById('breadcrumbs'),
            menuToggle: document.getElementById('menu-toggle'),
            loader: document.getElementById('loader')
        };

        // Initialize Icons
        lucide.createIcons();

        // 3.1 Build Navigation
        function buildNav(items, parentElement, level = 0) {
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = `ml-${level * 4}`;

                const link = document.createElement('div');
                link.className = `
                    flex items-center gap-2 px-3 py-2 rounded-md cursor-pointer transition-colors
                    ${level === 0 ? 'text-cyber-text hover:bg-cyber-panel hover:text-cyber-primary' : 'text-cyber-dim hover:text-white hover:bg-cyber-panel/50 text-xs'}
                    group
                `;
                
                // Click Handler
                link.onclick = (e) => {
                    e.stopPropagation();
                    if (item.children) {
                        // Toggle folder logic could go here
                        const childContainer = div.querySelector('.children-container');
                        if(childContainer) childContainer.classList.toggle('hidden');
                        const icon = link.querySelector('.folder-icon');
                        if(icon) icon.classList.toggle('rotate-90');
                    } else {
                        loadArticle(item.id, item.file, item.title);
                        if(window.innerWidth < 1024) toggleSidebar(); // Close sidebar on mobile
                    }
                };

                // Icon logic
                let iconHtml = '';
                if (item.icon) {
                    iconHtml = `<i data-lucide="${item.icon}" class="w-4 h-4 text-cyber-secondary group-hover:text-cyber-primary transition-colors"></i>`;
                } else if (!item.children) {
                    iconHtml = `<i data-lucide="file-text" class="w-3 h-3 group-hover:text-cyber-primary transition-colors"></i>`;
                } else {
                    iconHtml = `<i data-lucide="chevron-right" class="w-3 h-3 folder-icon transition-transform"></i>`;
                }

                link.innerHTML = `${iconHtml}<span>${item.title}</span>`;
                div.appendChild(link);

                if (item.children) {
                    const childrenContainer = document.createElement('div');
                    childrenContainer.className = "children-container ml-2 border-l border-cyber-panel pl-2";
                    buildNav(item.children, childrenContainer, level + 1);
                    div.appendChild(childrenContainer);
                }

                parentElement.appendChild(div);
            });
            lucide.createIcons();
        }

        buildNav(directoryStructure, dom.navTree);


        // 3.2 File Fetching & Parsing
        async function fetchTexContent(fileId, filePath) {
            dom.loader.classList.remove('hidden');

            try {
                let content = "";
                
                if (IS_PREVIEW_MODE) {
                    // PREVIEW MODE: Load from JS Object
                    // filePath が null の場合 (例: home)、id をキーにする
                    const key = filePath || fileId;
                    content = mockDatabase[key] || "# 404 Not Found\nFile not defined in mock database.";
                    
                    // Simulate network delay for realism
                    await new Promise(r => setTimeout(r, 300));
                } else {
                    // REAL MODE: Fetch from server
                    // filePath が無い場合はエラーあるいはデフォルトパス
                    if (!filePath && fileId === 'home') {
                         // Home content handling for real mode (could be a local string or a file)
                         content = mockDatabase['home'];
                    } else if (filePath) {
                        const response = await fetch(filePath);
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        content = await response.text();
                    } else {
                        throw new Error("No file path specified");
                    }
                }

                return content;

            } catch (e) {
                console.error(e);
                return `# System Error\n\nCould not load content.\n\n\`${e.message}\``;
            } finally {
                dom.loader.classList.add('hidden');
            }
        }

        function parseSimpleMarkdown(text) {
            // Very simple Markdown-ish parser combined with TeX preservation
            // 1. Sanitize HTML (Basic)
            let html = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");

            // 2. Headers
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');

            // 3. Bold/Italic
            html = html.replace(/\*\*(.*?)\*\*/gim, '<strong class="text-white">$1</strong>');
            html = html.replace(/\*(.*?)\*/gim, '<em>$1</em>');

            // 4. Lists (Simple implementation)
            html = html.replace(/^\- (.*$)/gim, '<ul><li>$1</li></ul>');
            // Join adjacent lists (regex hack for simple lists)
            html = html.replace(/<\/ul>\s*<ul>/gim, '');

            // 5. Paragraphs (Split by double newline)
            // Be careful not to break MathJax blocks defined by $$
            // This is a naive implementation. For robust markdown, use a library like 'marked'
            
            // Temporary strategy: Replace double newlines with <br><br> unless inside math
            // For this demo, we assume the user puts math in $$ $$ or uses standard markdown structure.
            // We'll wrap lines that aren't headers/lists in <p> tags basically.
            
            const lines = html.split('\n');
            let output = '';
            let inList = false;

            lines.forEach(line => {
                if (line.startsWith('<h1>') || line.startsWith('<h2>') || line.startsWith('<h3>')) {
                    output += line;
                } else if (line.startsWith('<ul>')) {
                    output += line;
                } else if (line.trim() === '') {
                    // Empty line
                } else {
                    // Check if it's part of a math block context (simplified)
                    output += `<p>${line}</p>`;
                }
            });

            // Clean up excessive p tags around block elements logic would go here in a full parser
            // For this lightweight version, we stick to the regex replacements above for structure
            // and return the regex processed string directly, trusting MathJax to find $$ delimiters.
            
            return html.replace(/\n/g, '<br>'); 
        }

        // 3.3 Main Load Function
        async function loadArticle(id, file = null, title = "Home") {
            // Update UI
            document.querySelectorAll('#nav-tree .text-cyber-primary').forEach(el => {
                if(!el.closest('h1')) el.classList.remove('text-cyber-primary'); // messy selector cleanup
            });
            
            // Update Breadcrumbs
            dom.breadcrumbs.innerHTML = `<span>ROOT</span> <i data-lucide="chevron-right" class="w-3 h-3"></i> <span class="text-cyber-primary uppercase">${title}</span>`;

            // Fetch
            const rawContent = await fetchTexContent(id, file);
            
            // Parse (Naive Markdown + Raw TeX)
            const htmlContent = parseSimpleMarkdown(rawContent);
            dom.article.innerHTML = htmlContent;

            // Typeset Math
            if (window.MathJax) {
                await MathJax.typesetPromise([dom.article]);
                applyMathScroll();
            }

            // Scroll to top
            document.getElementById('main-scroll').scrollTop = 0;
        }

        // 3.4 Math Scrolling Logic
        function applyMathScroll() {
            // MathJax 3 generates <mjx-container>. We need to wrap Display math to allow scrolling.
            const mathDisplays = dom.article.querySelectorAll('mjx-container[display="true"]');
            
            mathDisplays.forEach(mjx => {
                // Check if already wrapped
                if (mjx.parentElement.classList.contains('math-scroll-wrapper')) return;

                const wrapper = document.createElement('div');
                wrapper.className = 'math-scroll-wrapper';
                
                mjx.parentNode.insertBefore(wrapper, mjx);
                wrapper.appendChild(mjx);
            });
        }

        // 3.5 UI Event Handlers
        function toggleSidebar() {
            dom.sidebar.classList.toggle('-translate-x-full');
            dom.overlay.classList.toggle('hidden');
        }

        dom.menuToggle.addEventListener('click', toggleSidebar);
        dom.overlay.addEventListener('click', toggleSidebar);

        // --- 4. INITIALIZATION ---
        // Load Home on Start
        window.addEventListener('DOMContentLoaded', () => {
            loadArticle('home');
        });

    </script>
</body>
</html>
